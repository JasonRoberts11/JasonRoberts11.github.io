<!DOCTYPE html>
<html>
    <head>
        <title id="title">THIS IS GOOD</title>
        <link id="icon" rel="icon" href="icon1.png">
        <meta name="viewport" content="width=device-width,user-scalable=no">

    </head>
    <body style="margin:0;padding:0;" onresize="upScr()">
        <!--<h1 id="head">JASN 188</h1>
        <p><i>There are some <strong>bugs</strong> in here</i></p>
        <p id = "output"></p>
        <button id ="test">TEST</button><br/>-->
        <div>
        <canvas id="main" width="500" height="500" style="position:absolute;top:0;left:0;z-index:0;">
            </canvas></div><button id="Load" style="margin:20;padding:20;position:fixed;top:0;left:0;z-index:999;display:none;height:60px;width:120px">LOAD</button>
        <!--<div style="position:fixed;bottom:0;border:1px solid black;max-height: 200px;margin:auto;">
        <div id="preview">
            </div>
            </div>-->
        <script type="text/javascript" src="d_html.json"></script>
		<script type="text/javascript" src="element.js"></script>
        <script type="text/javascript" src="sound.js"></script>
        <script type="text/javascript" src="colorblocks.js"></script>
        <script>
           // playPitch(400,0.1,'square');
					var mode = "zubble";
			
			var alphabet = "abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            var main = document.getElementById("main");
            var preview = document.getElementById("preview");
            var ctx = main.getContext("2d");
            var scrwid =window.innerWidth-10;
            var scrhig=window.innerHeight-10;
            main.getAttributeNode("width").value=scrwid;
            main.getAttributeNode("height").value=scrhig;
            var tempo=1000;
            var title = document.getElementById("title");
            var icon = document.getElementById("icon");
            //var sleepers = [];
            /*var head = document.getElementById("head");
            var output = document.getElementById("output");
            var testButton = document.getElementById("test");
            testButton.onclick = function test(){
                //addElement(1,200,200);
                //updateMaxLayer();
                addElement(maine,1,1,0,0);
                
                
            }*/
            function runObjAtTime(ree,time){
                setTimeout(
					function(){
						//console.log(ree)
                maine.findGoThis(ree)},time);
            }
            function FrunObjAtTime(ree,time){
                setTimeout(
					function(){
						//console.log(ree)
                maine.findGoThat(ree)},time);
            }
            
            
            
            
            
            
            
            
            icond=1;
			var tby =30;
			function upScr(){
                scrwid =window.innerWidth-5;
                scrhig=window.innerHeight-5;
                if(/*scrwid <scrhig*/false){
                     maine.size = scrwid/2;
				maine.absx = scrwid/2;
				maine.absy = scrwid/2+tby;
                       
                   sbhig=scrhig;
			         sbx=0;
                    side=false;
                    main.getAttributeNode("width").value=scrhig;
            main.getAttributeNode("height").value=scrhig;
                }else{
     maine.size = (scrhig-2*tby)/2;
				maine.absx = (scrhig-tby*2)/2;
				maine.absy = (scrhig-2*tby)/2+tby;
                    sbhig=scrhig;
			sbx=scrwid;
                    
                    side=true;
                    main.getAttributeNode("width").value=scrwid;
            main.getAttributeNode("height").value=scrhig;
                }
				update();
			}
            var iconchanger=setInterval(function(){
                icon.getAttributeNode("href").value = "icon"+icond+".png";
                icond=(icond%2)+1;
            },1000);
			var consolet="Start";
            var mousex;
            var mousey;
            var mdx = 0;
            var mdy = 0;
            var copy=0;
            var sleeping = [];
            var sleep=false;
            
            var mousepressed=0;
            var upmos=0;
             var cdlay = 100;
            var dat = new Date();
            var time= dat.getTime;
            function setMouse(event){
                if(true){
                   main.focus();
                   }
                var dt = new Date().getTime()-time;
                if(mousepressed==1&&dt>cdlay){
                mousepressed=2;
                    //console.log(mousepressed+" "+dt);
                }
                if(mousepressed==3&&dt>cdlay){
                mousepressed=4;
                    //console.log(mousepressed+" "+dt);
                }
                mdx = event.layerX-mousex;
                mdy = event.layerY-mousey;
                mousex = event.layerX;
                mousey = event.layerY;
                //if(mousepressed==1||upmos<10){
                if(picked==-1){
                    //setSelection();
                }else{
                    //setOver();
                }
                //output.innerHTML="Mouse: " +mousex+ " "+mousey
                /*if(selected!=-1){
                   output.innerHTML+=" Parent: "+ elements[selected][1];
                    output.innerHTML+=" Children: " +elements[selected][2];
                    output.innerHTML+=" Layer: "+ elements[selected][8];
                }*/
                update();
                title.innerHTML= Math.floor(Math.random()*1000)+" things to do"
                //}
            }
            function setTouch(event){
                event.preventDefault();
                var dt = new Date().getTime()-time;
                if(mousepressed==1&&dt>cdlay){
                mousepressed=2;
                    //console.log(mousepressed+" "+dt);
                }
                if(mousepressed==3&&dt>cdlay){
                mousepressed=4;
                    //console.log(mousepressed+" "+dt);
                }
                var tou = event.changedTouches;
                if(tou.length==1){
                    var e = main.getBoundingClientRect();
                mdx = tou[0].pageX-e.left-mousex;
                mdy = tou[0].pageY-e.top-mousey;
                mousex = tou[0].pageX-e.left;
                mousey = tou[0].pageY-e.top;
                }
                //if(mousepressed==1||upmos<10){
                if(picked==-1){
                    //setSelection();
                }else{
                    //setOver();
                }
                //output.innerHTML="Mouse: " +mousex+ " "+mousey
                /*if(selected!=-1){
                   output.innerHTML+=" Parent: "+ elements[selected][1];
                    output.innerHTML+=" Children: " +elements[selected][2];
                    output.innerHTML+=" Layer: "+ elements[selected][8];
                }*/
                update();
                title.innerHTML= Math.floor(Math.random()*1000)+" things to do"
                //}
            }
            function click(event){
                var dt = new Date().getTime()-time;
                if(mousepressed==0){
                mousepressed=1;
                }
                if(dt<cdlay){
                mousepressed=3;
                }
                update();
                
                time=new Date().getTime();
                update();
                //console.log(mousepressed+" "+dt);
                //console.log("click")
            }
            ///MOUSEPRESSED AS FOLLOWS:
            ///0: Not pressed
            ///1: Just Clicked
            ///2: Held Once
            ///3: Clicked twice
            ///4: Held Twice
            function cluck(event){
                var dt = time-dat.getTime();
                upmos=0;
                mousepressed=0;
                //if(mousepressed==1){
                //mousepressed=0;
                //}
                //if(mousepressed==3){
                //mousepressed=0;
                //}
                update();
                time=new Date().getTime();
                update();
                //console.log("cluck")
            }
            function tap(event){
				mdx=0;
				mdy=0;
                var tou = event.changedTouches;
                if(tou.length==1){
                    var e = main.getBoundingClientRect();
                mdx = tou[0].pageX-e.left-mousex;
                mdy = tou[0].pageY-e.top-mousey;
                mousex = tou[0].pageX-e.left;
                mousey = tou[0].pageY-e.top;
                }
				mdx=0;
				mdy=0;
                event.preventDefault();
                var dt = new Date().getTime()-time;
                if(mousepressed==0){
                mousepressed=1;
                }
                if(dt<cdlay){
                mousepressed=3;
                }
                update();  
                time=new Date().getTime();
            }
            function untap(event){
                event.preventDefault();
                var dt = time-dat.getTime();
                upmos=0;
                mousepressed=0;
                time=new Date().getTime();
                update();
                update();
                //console.log("cluck")
            }
            document.addEventListener('mousemove',setMouse);
            document.addEventListener('mousedown',click);
            document.addEventListener('mouseup',cluck)
            main.addEventListener('touchmove',setTouch,false);
            main.addEventListener('touchstart',tap,false);
            main.addEventListener('touchend',untap,false)
            offcan = document.createElement('canvas');
            offcan.width = scrwid;
            offcan.height= scrhig;
            offctx = offcan.getContext('2d');
            /*function renderOffCan(i){
                for(k=0;k<elements[i][2].length;k++){
                    rendChild(i);
                }
            }*/
            /*function rendChild(i){
                p=elements[i][1];
                for(var k = 0;k<elements[i][2].length;k++){
                    rendChild(elements[i][2][k]);   
                }
            }*/
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            var elements = new Array(0);
            var maxlayer = 0;
            var selected;
            var picked;
            var over;
            var seldat =-1;
            var selrad = 10;
            var defsize = 25;
            var ddde=10;
			var parent=null;
            
            //THE STRUCTURE FOR THE Element OBject
            //Absolutes then the easily changed...
            // 0type, 1parent, 2children[], 3local xpos, 4local ypos, 5connections[],  6abs xpos, 7abs ypos, 8layer , 9size,10 open?
            
            
            
            //OBjECT
           
            var maine = new element(null,1,scrwid/2,scrwid/2);
            maine.size = scrwid/2;
            maine.color = 0;
            //console.log(bob.type);
            
            //TYPE STRUCTURES
            // type: 1 
            //  A basic circle
            /**for(var i = 0; i < 100; i++){
                elements[i] = new Array(Math.random()*100,Math.random()*100);
            }
            for(var i = 0; i < 100; i++){
                ctx.fillStyle ='rgb(0,0,'+i*10+')';
                ctx.beginPath();
                ctx.arc(elements[i][0]+250,elements[i][1]+250,10,0,2*Math.PI);
                ctx.fill();
                ctx.stroke();
            }**/
            //var uptimer = setInterval(function(){update()},100);
            var upmostim = setInterval(function(){upmos++;},100);
			
			
			////UPDATE/////////////////////////////////////////////////////////
            function update(){
                //head.innerHTML="JASN "+(Math.floor(Math.random()*1000));
                ctx.clearRect(0,0,scrwid,scrhig);
                maine.render();
				//selected= maine;
				drawSideBar();
				drawTopBar();
				drawConsole();
				dragger();
				maine.updateChildSize();
            }
			var startphys= window.setInterval(function(){
				   ctx.clearRect(0,0,scrwid,scrhig);
				maine.childPhys();
				maine.render();
				drawSideBar();
				drawTopBar();
				drawConsole();
				if(dragged!=null){
				    dragged.render();
                    if(selected!=null)
                    selected.bold=1;
                    selected=null;
                    maine.getSelection();
                    if(selected!=null)
                    selected.bold=2;
				}
				//dragger();
			},10);
            
			
			
			
			
			
            function addElement(parent,i,type,x,y){
                var e = new element(i,type,x,y);
                e.absx = maine.absx+x;
                e.absy = maine.absy+y;
				e.parent = parent;
                maine.add(e);
            }
			function dragElement(e){
				e.move(mdx,mdy);
			}
			dragged = null;
			var nodrag = null;
			function dragger(){
				console.log(mousepressed);
				
				if(mousepressed==1){
					if(dist2(mdx,mdy,0,0)>3){
						mousepressed=2;
						mousex-=mdx;
						mousey-=mdy;
						mdx=0;
						mdy=0;
					}
				}
                if(mousepressed==4){
					if(dist2(mdx,mdy,0,0)>5){
						mousepressed=5;
						mousex-=mdx;
						mousey-=mdy;
						mdx=0;
						mdy=0;
					}
				}
                //////////NODE DRAGGER
				if(mousepressed==5){
					if(nodrag==null){
					selected=null;
				    maine.getSelection();
					nodrag=selected;
					}
					if(nodrag!=null&&nodrag!=maine){
					var selp = nodrag.parent;
					nodrag.lx=mousex;
				    nodrag.ly=mousey;
					dragElement(nodrag);
						if(dist(mousex,mousey,selp.absx,selp.absy,selp.size)){
					nodrag.node=true;
					}else{
						
					}
				}
				}else{
					if(nodrag!=null){
						var selp = nodrag.parent;
                        if(selp!=null){
                        nodrag.x = -selp.absx+nodrag.absx;
                        nodrag.y = -selp.absy+nodrag.absy;
						if(!dist(mousex,mousey,selp.absx,selp.absy,selp.size)){
					nodrag.node=true;
					}else{
						nodrag.node=false;
					}
                    }
					nodrag=null;
				}
				}
                if(mousepressed==3){
                    selected=null;
				    maine.getSelection();
				    if(selected != maine&&selected!=null){
						if(selected.js!=null&&selected.js.name=="Function"&&mousey<selected.absy-selected.size+defsize){
						var r=prompt("Name?",selected.js.fname)
						if(r!=null)
						selected.js.fname=r;
						mousepressed=0;
                            nodrag=null;
				}else if(selected.js!=null&&selected.js.name=="raw"){
                           var r = "";
                            r = prompt("Text?",selected.js.text);
							if(r!=null)
                            selected.js.text=r;
                            selected=null;
                            mousepressed=0;
                               nodrag=null;
                           }else{
				        selected.togClose();
                               nodrag=selected;
                        mousepressed=4;
                              
                        }
                    }
                }
                if(mousepressed==0&&dragged==null){
                    if(selected!=null)
                    selected.tint=1;
                    selected=null;
                    maine.getSelection();
                    if(selected!=null){
                    selected.tint=1.2;
                    selected.reOrder();
                    if(selected.js!=null&&selected.js.name=="html"){
                      parseHtml(selected);  
                    }
                    }
                    
                }
				if(copy){
					if(mousepressed==2&&dragged==null){
				selected=null;
				maine.getSelection();
				if(selected != maine&&selected!=null){
					var coopy = selected.parseToJSON();
					dragged=new element(null,1,0,0);
					dragged.readJson(JSON.parse(JSON.stringify(coopy)));
				    dragged.deOrphanize();
				    dragged.updatePos();
					dragged.absx=mousex;
					dragged.absy=mousey;
                    dragged.tint=1.1;
				//dragged.removeParent();
				copy=false;}}
					
					
				}else{
				if(mousepressed==2&&dragged==null){
				selected=null;
				maine.getSelection();
				if(selected != maine&&selected!=null){
				dragged=selected;
                    dragged.tint=1.1;
				dragged.removeParent();
				dragged.node=false}
				}}
				if(dragged!=null){
				   dragElement(dragged);
				    dragged.render();
                    if(selected!=null)
                    selected.bold=1;
                    selected=null;
                    maine.getSelection();
                    if(selected!=null)
                    selected.bold=2;
				}
                //LET GO OF THE THING
				if(mousepressed==0&&dragged!=null){
                    if(selected!=null)
                    selected.bold=1;
					dragged.findParent(maine);
					dragged.render();
					if(dragged.js.name=="Function"){
					if(dragged.js.fname==null){
					dragged.js.fname="Function_"+(alphabet.charAt(functions.length));
					var r=prompt("Name?",dragged.js.fname)
					if(r!=null){
						dragged.js.fname=r;
					 	findFunctions();
					}else{
						dragged.parent.children.splice(dragged.parent.children.indexOf(dragged),1);
						dragged.parent = null;
					}
					}}
                    if(dragged.js.name=="var"){
					if(dragged.js.vname==null){
					dragged.js.vname="var_"+(alphabet.charAt(vars.length));
					var r=prompt("Name?",dragged.js.vname)
					if(r!=null)
						{
					dragged.js.vname=r;
							findVars();
						}else{
							dragged.parent.children.splice(dragged.parent.children.indexOf(dragged),1);
						dragged.parent = null;
						}
					}}
					dragged=null;
				}
			}
				
			
			
			function resetZubble(){
                 maine.dofntoall(
                'clearTimeout(this.sleept);'
            );
			}
			function runZubble(){
			//maine.setSkip();
				//maine.setEnable();
				for(var i =0;i<maine.children.length;i++){
						var cr = maine.children[i];	
					//console.log(cr.label);
						if (cr.label=="Initialize"){
							cr.run();
							//console.log("Initialized");
						}
                    }
			}
//var refunout;
            var ffunction;
            var functions=[];
            function findFunctions(){
                functions=[];
                maine.findFunctions();
            }
            var vvar;
            var vars=[];
            function findVars(){
                vars=[];
                maine.findVars();
            }
				
			///////SIDE BAR////////////////////////////////////////////
			var sbsiz = 100;
			var sbdy=30;
			var sbhig=scrhig;
			var sbx=scrwid;//THe RIGHT SIDE
			var tbs = 30;
			var sby=0+tbs;
			var side=true;
			var mbar = [];
			
			var sbar = 0;
			if(mode=="html"){
			mbar.push(JSON.parse(d_html));
            mbar.push(JSON.parse(d_javascript));
			}
			mbar.push(JSON.parse(d_zubble));
			mbar.push(JSON.parse(d_function))
			var par="";
			var upar="";
			function parseHtml(el){
                par="";
                el.parseChildren();
                //console.log(par);
                preview.innerHTML=par;
            }
 const rb=document.createElement('INPUT');
            rb.innerHTML=("LOAD");
			rb.setAttribute("type","file");
            //rb.setAttribute("onchange","changee()");
            rb.addEventListener("change",changee);
			rb.style.display='none';
			document.body.appendChild(rb);
            var loadb = document.getElementById("Load");
            loadb.addEventListener("click",function(){
                    rb.click();
                });
			function upload(){
                
                loadb.style.display='inline';
                rb.click();
			}
			function changee(event){
                loadb.style.display='none';
                                event.preventDefault();

				const file = rb.files.item(0);
				fileToText(file,(text)=>{
					upar=text;
					if(upar.charAt(0)=='{'){
						maine = new element(null,1,0,0);
						maine.readJson(JSON.parse(upar));
						upScr();
						maine.deOrphanize();
						maine.updatePos();
					//maine = JSON.parse(upar);
						//maine.eorphanize();
					}else{
						console.log("failed");
						log("failed");
					}
				});
				
			}
			function fileToText(file,callback){
				const reader = new FileReader();
				reader.readAsText(file);
				reader.onload = () =>{
					callback(reader.result);
				}
			}
			function download(name, string){
				var ra = document.createElement('a');
				ra.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(string));
				ra.setAttribute('download',name);
				ra.style.display='none';
				document.body.appendChild(ra);
				ra.click();
				document.body.removeChild(ra);
			}
			tbx=100;
			function drawTopBar(){
					ctx.fillStyle="#EEEEEE";
					ctx.fillRect(0,0,scrwid,tby);
					ctx.fillStyle="#444444";
				var sele=-1;
				var tes=["Save","Load","Run","Copy"]
				for(var i =0;i<tes.length;i++){
					ctx.fillStyle="#AAAAAA";
						ctx.fillRect(1+i*tbx,1,tbx-2,tby-2);
					ctx.fillStyle="#000000";
					if(i==3&&copy)
						ctx.fillStyle="#FFFFFF";
					ctx.textAlign="center";
						ctx.textBaseline="middle";
						ctx.font = "20px Arial";
						ctx.fillText(tes[i],i*tbx+0.5*tbx,tby/2);
					if(mousepressed==1&&Math.abs(mousex-(i*tbx+0.5*tbx))<tbx/2&&Math.abs(mousey-(tby/2))<tby/2){
					if(i==0&&sele==-1){
						mousepressed=-1;
						if(confirm("areyousure?")){
						//maine.orphanize();
						reeero = maine.parseToJSON();
							var r = prompt("Name?","Untitled");
                            if (r!=null)
						download(r,JSON.stringify(reeero));
						//maine.deOrphanize();
					}
					sele=1;
				}
						if(i==1&&sele==-1){
					mousepressed=-1;
                            console.log("ree");
                            
                            upload();
					sele=1;
				}
						if(i==2&&sele==-1){
					mousepressed=-1;
							consolet="";
							resetZubble();
					runZubble();
					sele=1;
				}
						if(i==3&&sele==-1){
					mousepressed=-1;
							if(!copy){
							copy=true;}else{
								copy=false;
							}
							
					sele=1;
				}
							}
				}
			}
			function log(string){
				consolet=string+",\n"+consolet;
			}
			function drawConsole(){
				ctx.fillStyle="#000000";
				ctx.fillRect(scrwid-300,scrhig-50,300,50);
				ctx.fillStyle="#FFFFFF";
				ctx.textAlign="left";
				ctx.textBaseline="middle";
				ctx.font = "10px Arial";
				ctx.fillText(consolet,scrwid-290,scrhig-40);
			}
            function drawSideBar(){
				if(side){
					ctx.fillStyle="#EEEEEE";
					ctx.fillRect(sbx-sbsiz,sby,sbsiz,sbhig);
					ctx.fillStyle="#444444";
						ctx.textAlign="center";
						ctx.textBaseline="middle";
						ctx.font = "20px Arial";
					for(var i=0;i<mbar.length;i++){
						ctx.fillStyle="#AAAAAA";
						ctx.fillRect(sbx-sbsiz,sby+i*sbdy,sbsiz,(1)*sbdy);
						ctx.fillStyle="#000000";
						ctx.fillText(mbar[i].name,sbx-sbsiz/2,sby+(i+0.5)*sbdy);
						if(i==sbar){
							ctx.beginPath();
							ctx.moveTo(sbx-sbsiz,sby+i*sbdy);
							ctx.lineTo(sbx-sbsiz-10,sby+(i+0.5)*sbdy);
							ctx.lineTo(sbx-sbsiz,sby+(i+1)*sbdy);
							ctx.closePath();
						}
                        if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*0.5))<sbsiz/2&&Math.abs(mousey-(sby+(i+0.5)*sbdy))<sbdy/2){
							sbar=i;
							}
					}
                   /* var i = mbar.length;
						ctx.fillStyle="#AAAAAA";
						ctx.fillRect(sbx-sbsiz,sby+i*sbdy,sbsiz,(1)*sbdy);
						ctx.fillStyle="#000000";
						ctx.fillText("Functions",sbx-sbsiz/2,sby+(i+0.5)*sbdy);
						if(i==sbar){
							ctx.beginPath();
							ctx.moveTo(sbx-sbsiz,sby+i*sbdy);
							ctx.lineTo(sbx-sbsiz-10,sby+(i+0.5)*sbdy);
							ctx.lineTo(sbx-sbsiz,sby+(i+1)*sbdy);
							ctx.closePath();
						}
                        if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*0.5))<sbsiz/2&&Math.abs(mousey-(sby+(i+0.5)*sbdy))<sbdy/2){
							sbar=i;
                            findFunctions();
							}
                     i ++;
						ctx.fillStyle="#AAAAAA";
						ctx.fillRect(sbx-sbsiz,sby+i*sbdy,sbsiz,(1)*sbdy);
						ctx.fillStyle="#000000";
						ctx.fillText("Variables",sbx-sbsiz/2,sby+(i+0.5)*sbdy);
						if(i==sbar){
							ctx.beginPath();
							ctx.moveTo(sbx-sbsiz,sby+i*sbdy);
							ctx.lineTo(sbx-sbsiz-10,sby+(i+0.5)*sbdy);
							ctx.lineTo(sbx-sbsiz,sby+(i+1)*sbdy);
							ctx.closePath();
						}
                        if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*0.5))<sbsiz/2&&Math.abs(mousey-(sby+(i+0.5)*sbdy))<sbdy/2){
							sbar=i;
                            findVars();
							}
					*/
					var j = 0;
                    if(sbar<mbar.length){
					for(var i=0;i<mbar[sbar].array.length;i++){
						var r = mbar[sbar].array[i];
						ctx.font = "20px Arial";
						ctx.fillStyle="#CCCCCC";
						ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
						ctx.fillStyle="#000000";
						ctx.fillText(r.name,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
                        if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
							if(r.open){	
                            r.open=false;
                            }else{
                                r.open=true;
                            }
							mousepressed=2;
							}
						j++;
                        if(r.open){
						for(var k = 0;k<r.set.length;k++){
							//r.set[k]
							ctx.font = "15px Arial";
							ctx.fillStyle="#EEEEEE";
							ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
							ctx.fillStyle=atint(colorblocks[r.set[k].color],0.4);
							ctx.fillRect(sbx-sbsiz*2+1,sby+j*sbdy+1,sbsiz-2,(1)*sbdy-2);
							ctx.fillStyle="#000000";
							ctx.fillText(r.set[k].name,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
							
							if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
								dragged=new element(0,1,mousex,mousey);
								dragged.label=r.set[k].name;
                                dragged.color=r.set[k].color;
                                dragged.js=JSON.parse(JSON.stringify(r.set[k]));
                                dragged.create();
                                mousepressed=2;
							}
							j++;
						}
                    	if(r.name=="Functions"){
							for(var k = 0;k<functions.length;k++){
							//r.set[k]
							ctx.font = "15px Arial";
							ctx.fillStyle="#EEEEEE";
							ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
							ctx.fillStyle="#000000";
							ctx.fillText(functions[k].js.fname,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
							
							if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
								dragged=new element(0,1,mousex,mousey);
								dragged.label=functions[k].js.fname;
                                dragged.js=JSON.parse('{"name":"test","color":6}');
                                dragged.js.name=functions[k].js.fname;
                                dragged.color=5;
                                dragged.create;
								dragged.js.fun=true;
                                mousepressed=2;
							}
							j++;
						}
						}
							if(r.name=="Variables"){
								for(var k = 0;k<vars.length;k++){
							//r.set[k]
							ctx.font = "15px Arial";
							ctx.fillStyle="#EEEEEE";
							ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
							ctx.fillStyle="#000000";
							ctx.fillText(vars[k].js.vname,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
							
							if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
								dragged=new element(0,1,mousex,mousey);
								dragged.label=vars[k].js.vname;
                                dragged.js=JSON.parse('{"name":"test","color":6}');
                                dragged.js.name=vars[k].js.vname;
                                dragged.color=5;
                                dragged.create;
								dragged.js.vun=true;
                                mousepressed=2;
							}
                                 j++;
                             }
							}
						}
					}
					ctx.fillStyle="#AAAAAA";
					ctx.fill();
				}else{/*if(sbar==mbar.length){
					
						for(var k = 0;k<functions.length;k++){
							//r.set[k]
							ctx.font = "15px Arial";
							ctx.fillStyle="#EEEEEE";
							ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
							ctx.fillStyle="#000000";
							ctx.fillText(functions[k].js.fname,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
							
							if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
								dragged=new element(0,1,mousex,mousey);
								dragged.label=functions[k].js.fname;
                                dragged.js=JSON.parse('{"name":"test","color":6}');
                                dragged.js.name=functions[k].js.fname;
                                dragged.color=5;
                                dragged.create;
								dragged.js.fun=true;
                                mousepressed=2;
							}
							j++;
						}}if(sbar==mbar.length+1){
                             for(var k = 0;k<vars.length;k++){
							//r.set[k]
							ctx.font = "15px Arial";
							ctx.fillStyle="#EEEEEE";
							ctx.fillRect(sbx-sbsiz*2,sby+j*sbdy,sbsiz,(1)*sbdy);
							ctx.fillStyle="#000000";
							ctx.fillText(vars[k].js.vname,sbx-sbsiz*1.5,sby+(j+0.5)*sbdy);
							
							if(mousepressed==1&&Math.abs(mousex-(sbx-sbsiz*1.5))<sbsiz/2&&Math.abs(mousey-(sby+(j+0.5)*sbdy))<sbdy/2){
								dragged=new element(0,1,mousex,mousey);
								dragged.label=vars[k].js.vname;
                                dragged.js=JSON.parse('{"name":"test","color":6}');
                                dragged.js.name=vars[k].js.vname;
                                dragged.color=5;
                                dragged.create;
								dragged.js.vun=true;
                                mousepressed=2;
							}
                                 j++;
                             }
                    }*/}

					ctx.fillStyle="#AAAAAA";
					ctx.fill();
                }
			}
            upScr();
            
            function dist(x,y,x2,y2,r){
                if(Math.pow((x-x2),2)+Math.pow((y-y2),2)<Math.pow(r,2)){
                    return true;
                }else{
                    return false;
                }
            }
            function dist2(x,y,x2,y2){
                return (Math.pow((Math.pow((x-x2),2)+Math.pow((y-y2),2)),0.5));
            }
            function tint(color,tint){
                return("rgb("+color[0]*tint+","+color[1]*tint+","+color[2]*tint+")");
            }
			function atint(color,a){
                return("rgb("+((color[0]-255)*a+255)+","+((color[1]-255)*a+255)+","+((color[2]-255)*a+255)+")");
            }
        
        </script>
        
        
        
    </body>
</html>